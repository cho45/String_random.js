<!DOCTYPE html>
<html>
	<head>
		<title>Demo of String_random.js</title>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

		<meta name="keywords" content="JavaScript,Library,RegExp,Regular Expression,Random String"/>
		<meta name="description" content="String_random.js is a library for generating random string from a regular experession."/>

		<meta property="og:email" content="cho45@lowreal.net" />
		<meta property="fb:admins" content="cho45" />

		<meta name="twitter:site" content="cho45"/>
		<meta name="twitter:creator" content="cho45"/>

		<style>
	body {
		padding: 32px 0;
		background: #f8f8fa;
		color: #23242a;
		font-family: 'Fira Mono', 'Menlo', 'Consolas', 'Monaco', monospace;
	}
	.container {
		max-width: 900px;
		margin: 0 auto;
		background: #fff;
		border-radius: 10px;
		box-shadow: 0 4px 24px rgba(0,0,0,0.08);
		padding: 32px 32px 24px 32px;
	}
	h1 {
		font-size: 2.2em;
		font-weight: bold;
		letter-spacing: 0.02em;
		color: #ffb86c;
		margin-bottom: 0.5em;
	}
	.lead {
		color: #666;
		font-size: 1.1em;
		margin-bottom: 2em;
	}
	form {
		margin-bottom: 2em;
	}
	input[name="regexp"] {
		font-family: inherit;
		font-size: 1.2em;
		background: #f8f8fa;
		color: #23242a;
		border: 1.5px solid #bbb;
		border-radius: 6px;
		padding: 12px 16px;
		margin-bottom: 12px;
		transition: border 0.2s;
		width: 100%;
		box-sizing: border-box;
	}
	input[name="regexp"]:focus {
		border-color: #ffb86c;
		outline: none;
	}
	input[type="submit"], .btn-primary {
		background: #ffb86c;
		color: #23242a;
		border: none;
		font-weight: bold;
		transition: background 0.2s;
		font-size: 1.3em;
		padding: 16px 40px;
		border-radius: 8px;
		box-shadow: 0 2px 8px rgba(0,0,0,0.07);
		margin-bottom: 10px;
	}
	input[type="submit"]:hover, .btn-primary:hover {
		background: #ffa94d;
	}
	#examples {
		margin-top: 10px;
		font-size: 0.98em;
		color: #0077b6;
	}
	#examples a {
		color: #0077b6;
		text-decoration: underline dotted;
		margin: 0 2px;
		cursor: pointer;
		transition: color 0.2s;
	}
	#examples a:hover {
		color: #ffb86c;
	}
	.jumbotron {
		background: #f8f8fa;
		border-radius: 8px;
		box-shadow: 0 2px 8px rgba(0,0,0,0.04);
		padding: 40px 20px 20px 20px;
	}
	.jumbotron p {
		font-size: 1.1em;
		background: #fffbe6;
		border-left: 4px solid #ffb86c;
		padding: 8px 16px;
		margin-bottom: 18px;
		border-radius: 4px;
		word-break: break-all;
		color: #23242a;
		font-family: inherit;
	}
	.twitter-share-button {
		margin-left: 10px;
		background: #1da1f2;
		color: #fff !important;
		border-radius: 4px;
		padding: 2px 10px;
		font-size: 0.95em;
		text-decoration: none;
		transition: background 0.2s;
		border: none;
		display: inline-block;
	}
	.twitter-share-button:hover {
		background: #0d8ddb;
	}
	@media (max-width: 900px) {
		.container {
			max-width: 100vw;
			padding: 12px 2vw 12px 2vw;
		}
		.jumbotron {
			padding: 24px 4vw 12px 4vw;
		}
	}
		</style>
	</head>
	<body>
		<div class="container">
			<div style="text-align: center">
				<h1>Demo of String_random.js</h1>

				<p class="lead"><a href="https://github.com/cho45/String_random.js">String_random.js</a> is a library for generating random string from a regular experession.</p>
			</div>

			<form style="text-align: center; padding: 30px 0" class="">
				<div class="form-group">
					<input type="text" name="regexp" placeholder="RegExp" class="form-control input-lg" required/>
				</div>
				<input type="submit" value="Generate" class="btn btn-primary btn-lg"/>
				<div id="examples">
					Examples:
					<a href="javascript:void()" data-regexp="\d+">Numbers</a>,
					<a href="javascript:void()" data-regexp="https?:\/\/[a-z]{3,8}\.example\.com\/([a-z\d]+\/){3}">URL</a>,
					<a href="javascript:void()" data-regexp="#[0-9a-f]{6}">Hex Color</a>,
					<a href="javascript:void()" data-regexp="セミの鳴き声です: ( (ミー?ン)+|(ツクツク|ホーシ)+|(ジー?)+)">セミの鳴き声</a>,
					<a href="javascript:void()" data-regexp="[あ-お]{5} [あ-お]{7} [あ-お]{5}">川柳</a>,
					<a href="javascript:void()" data-regexp="(ルイズ！)+((ルイズ！?)+|(ぅ*う*わぁ+あ+ん！+)|あ+[あ…ぁ]+|[うぅ]+)+">ルイズ</a>,
				</div>
			</form>

			<div style="position: relative">
				<div class="jumbotron" id="output" style="padding-top: 90px">
				</div>
				<!-- div style="position: absolute; top: 30px; left: 60px" id="twitter-button">
				</div -->
			</div>
		</div>

		<script type="module">
			import { String_random } from './lib/String_random.js';

			function seededRandom(seed) {
				let x = seed >>> 0;
				return function me() {
					// Xorshift32アルゴリズム
					x ^= x << 13;
					x ^= x >>> 17;
					x ^= x << 5;
					me.seed = x;
					return (x >>> 0) / 0x100000000;
				};
			}


			function generate (re, seed) {
				var input = document.querySelector('input[name=regexp]');
				var output = document.getElementById('output');
				output.innerHTML = '';

				if (!re) {
					re = input.value;
					if (!re) return;
				}

				if (typeof seed === "undefined") seed = new Date().getMilliseconds();

				input.value = re.source || re;

				const params = new URLSearchParams();
				params.set('seed', seed);
				params.set('regexp', input.value);

				location.hash = '#' + params.toString();
				document.title = input.value;

				console.log('seed:', seed);
				const random = seededRandom(seed);
				for (let i = 0; i < 10; i++) {
					const generated = String_random(re, { random });

					const p = document.createElement('p');
					p.textContent = generated;
					const params = new URLSearchParams();
					params.set('url', location.href);
					params.set('text', `${generated} #string_random_js`);

					const url = `https://twitter.com/intent/tweet?${params.toString()}`;

					const a = document.createElement('a');
					a.href = url;
					a.target = '_blank';
					a.className = 'btn btn-sm btn-info twitter-share-button';
					a.textContent = 'Tweet';
					p.appendChild(a);
					output.appendChild(p);
				}
			}

			document.getElementById('examples').addEventListener('click', function (e) {
				if (e.target.tagName === 'A') {
					e.preventDefault();
					e.stopPropagation();
					const regexp = e.target.getAttribute('data-regexp');
					generate(regexp);
				}
			});

			document.querySelector('form').addEventListener('submit', function (e) {
				generate();
				e.preventDefault();
			});

			window.onhashchange = function (a, b) {
				const hash = location.hash.replace(/^#/, '');
				if (hash.match(/regexp=/)) {
					const params = new URLSearchParams(hash);
					const seed = parseInt(params.get('seed'), 10);
					if (params.has('regexp')) {
						if (seed) {
							generate(new RegExp(params.get('regexp')), seed);
						} else {
							generate(new RegExp(params.get('regexp')));
						}
						return;
					}
				} else {
					// backward compatibility
					generate(new RegExp(decodeURIComponent(hash)));
				}
			};

			window.onhashchange();
		</script>
	</body>
</html>
